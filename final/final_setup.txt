# Steps to execute the process
1) Set up environment on a aws p2 instance
     - Install Ubuntu environment as laid out here : http://course.fast.ai/lessons/aws.html
     - Install R, and package data.table
2) Place the train-all folder under /data/fish/
3) Place the test-stg2 files under /data/fish/test and also place them under /data/fish/test/test
4) Place the image_validation_set.csv in the main folder. This holds the validations data
5) Create directory data/fish/results
6) Check that the annotations (from kaggle forum here: http://bit.ly/2nN05Ld) are in ../data/fish/annos/{}_labels.json
7) Check that the labels from Liu Weijie in this post http://bit.ly/2nBceSA are under ../data/fish/annos1/{}.json
8) Place the relabelling file from this post (http://bit.ly/2o8W9Vw) under the directory ../data/fish/relabel/relabels.csv
9) Git clone the darknet directory in the main directory as seen here :
	git clone https://github.com/pjreddie/darknet
	cd darknet
	make
10) Place the labels from Liu Weijie in this post http://bit.ly/2nBceSA under fish/darknet/FISH/annos
11) Mkdir final/checkpoints/checkpoint03A, final/checkpoints/checkpoint03C, final/checkpoints/checkpoint03C
12) Change R blending script called *** to point at home directory in setwd() step.
**** Update this part later
Earlier) Copy the yolo test bounding boxes to ../yolo_coords/
    move yolo comp4_det_test_FISH544.txt to yolo_coords/comp4_det_test_FISH544.txt
    move yolo comp4_det_test_FISH414.txt to yolo_coords/comp4_det_test_FISH.txt
    move yolo comp4_det_test_FISH414.txt to yolo_coords/comp4_det_test_FISH540.txt # This one came from a bug.
****



###########################################################

# Script 1
cp ../scripts/old/test_anno_0.797.ipynb 1_conv_all_anno.ipynb
jupyter nbconvert --to=python  1_conv_all_anno.ipynb
# Vim file
# -> Turn off the show image in chunk 9
# -> Set bags to 20, and set bags in the model run
# -> Set input_exists and refresh_directories to False and True
# -> Change array stored to a new name.. .eg. 1_ added to the start
# -> Change the out path anfd ile to 'sub/subm_full_conv_anno_1.csv'
# -> Change the model from a list to reset each time
# -> Turn off verbose and put a log for each batch round
# -> Turn off the show image in chunk 16
# -> Comment out the File Link
# -> Remove line "get_ipython().magic(u'matplotlib inline')"
nohup python 1_conv_all_anno.py &> 1_conv_all_anno.out&

# Script 2
cp ../scripts/test_anno_relabel.ipynb 2_conv_all_relabel.ipynb
jupyter nbconvert --to=python  2_conv_all_relabel.ipynb
# Vim file
# -> Turn off the show image in chunk 9
# -> set bags to 20, and set bags in the model run
# -> Set input_exists and refresh_directories to False and True
# -> Change array stored to a new name.. .eg. 1_ added to the start
# -> change the out path anfd ile to 'sub/subm_full_conv_relabel_2.csv'
# -> change the model from a list to reset each time
# -> Turn off the show image in chunk 16
# -> comment out the File Link
# -> Remove line "get_ipython().magic(u'matplotlib inline')"
nohup python 2_conv_all_relabel.py &> 2_conv_all_relabel.out&

# Script 3
cp ../resnet/resnet_02-full.ipynb 3A_resnet_crop_partial.ipynb
jupyter nbconvert --to=python  3A_resnet_crop_partial.ipynb
nohup python 3A_resnet_crop_partial.py &> 3A_resnet_crop_partial.out&

cp 3A_resnet_crop_partial.py 3B_resnet_crop_partial.py
cp 3A_resnet_crop_partial.py 3C_resnet_crop_partial.py
On each of the new files change the checkpoint directory and the outputted file accordingly
nohup python 3B_resnet_crop_partial.py &> 3B_resnet_crop_partial.out&
nohup python 3C_resnet_crop_partial.py &> 3C_resnet_crop_partial.out&


# Script 4 
cp ../resnet/resnet_07-yolo544-flip.ipynb 4A_resnet_cropsq_partial.ipynb
jupyter nbconvert --to=python  4A_resnet_cropsq_partial.ipynb
nohup python 4A_resnet_cropsq_partial.py &> 4A_resnet_cropsq_partial.out&
nohup python 4B_resnet_cropsq_partial.py &> 4B_resnet_cropsq_partial.out&
nohup python 4C_resnet_cropsq_partial.py &> 4C_resnet_cropsq_partial.out&
mkdir checkpoints/checkpoint04A
mkdir checkpoints/checkpoint04B
mkdir checkpoints/checkpoint04C

# Script 5?
copy script 4 and change to 360 x 360 
nohup python 5A_resnet_cropbig_partial.py &> 5A_resnet_cropbig_partial.out&
nohup python 5B_resnet_cropbig_partial.py &> 5B_resnet_cropbig_partial.out&
nohup python 5C_resnet_cropbig_partial.py &> 5C_resnet_cropbig_partial.out&
mkdir checkpoints/checkpoint05A
mkdir checkpoints/checkpoint05B
mkdir checkpoints/checkpoint05C

# Script 6
Rscript avg_subs_final_round1.R # Run this rscript
cp ../scripts/test_pseudo.ipynb 6_conv_all_pseudo.ipynb
jupyter nbconvert --to=python  6_conv_all_pseudo.ipynb
nohup python 6_conv_all_pseudo.py &> 6_conv_all_pseudo.out&

